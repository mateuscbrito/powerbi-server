<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formul√°rio de Briefing de Dashboard - SARA BI</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* SARA Identity Colors */
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --background: #0f172a;
            --surface: #1e293b;
            --surface-glass: rgba(30, 41, 59, 0.7);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
            --success: #10b981;
            --error: #ef4444;

            /* Shadows & Glows - Reduced Intensity */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.2);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.2), 0 2px 4px -2px rgb(0 0 0 / 0.2);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.2), 0 4px 6px -4px rgb(0 0 0 / 0.2);
            --glow-primary: 0 0 5px rgba(59, 130, 246, 0.2);

            /* Transitions */
            --transition: 0.2s ease-in-out;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #020617 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            padding-bottom: 100px;
            /* Space for floating button */
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--background);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--surface);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-500);
        }

        /* Progress Bar */
        .progress-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            z-index: 1001;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 3rem 2rem;
            background: var(--surface-glass);
            backdrop-filter: blur(12px);
            border-radius: 1.5rem;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            margin-top: 2rem;
        }

        .header .logo {
            height: 64px;
            margin-bottom: 1.5rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
            transition: transform var(--transition);
        }

        .header .logo:hover {
            transform: scale(1.05) rotate(2deg);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
            background: linear-gradient(135deg, #fff 0%, #94a3b8 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.02em;
        }

        .header p {
            font-size: 1.125rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Container */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Form Sections */
        .form-section {
            background: var(--surface-glass);
            backdrop-filter: blur(12px);
            border-radius: 1rem;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            transition: all var(--transition);
        }

        .form-section:hover {
            box-shadow: var(--shadow-lg);
            border-color: rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }

        .form-section h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .section-icon {
            font-size: 1.5rem;
            background: rgba(59, 130, 246, 0.1);
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        /* Grid */
        .form-grid {
            display: grid;
            gap: 2rem;
        }

        .form-grid.two-cols {
            grid-template-columns: 1fr 1fr;
        }

        /* Fields */
        .field-group {
            margin-bottom: 1.5rem;
            position: relative;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            margin-bottom: 0.75rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Tooltip */
        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            font-size: 10px;
            cursor: help;
            position: relative;
        }

        .tooltip-icon:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem 1rem;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 0.5rem;
            color: var(--text-primary);
            font-size: 0.75rem;
            white-space: pre-wrap;
            width: max-content;
            max-width: 250px;
            z-index: 10;
            box-shadow: var(--shadow-lg);
            margin-bottom: 0.5rem;
            text-transform: none;
            line-height: 1.4;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
            transition: all var(--transition);
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
            background: rgba(15, 23, 42, 0.8);
        }

        .form-input.invalid,
        .form-textarea.invalid {
            border-color: var(--error);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        /* Character Counter */
        .char-counter {
            position: absolute;
            bottom: -1.2rem;
            right: 0;
            font-size: 0.75rem;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        /* Checkboxes */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.4);
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all var(--transition);
            color: var(--text-secondary);
        }

        .checkbox-label:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .checkbox-label:has(input:checked) {
            background: rgba(59, 130, 246, 0.15);
            border-color: var(--primary);
            color: white;
            box-shadow: inset 0 0 0 1px var(--primary);
        }

        .checkbox-label input[type="checkbox"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--text-secondary);
            border-radius: 4px;
            background: transparent;
            cursor: pointer;
            position: relative;
            transition: all 0.2s;
        }

        .checkbox-label input[type="checkbox"]:checked {
            background: var(--primary);
            border-color: var(--primary);
        }

        .checkbox-label input[type="checkbox"]:checked::after {
            content: '‚úì';
            position: absolute;
            color: white;
            font-size: 14px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            font-weight: 600;
            padding: 1rem 2.5rem;
            border-radius: 0.75rem;
            transition: all var(--transition);
            cursor: pointer;
            border: none;
            font-size: 1rem;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5);
            filter: brightness(1.1);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(1);
        }

        /* Floating Action Button Container */
        .fab-container {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 900;
            display: flex;
            gap: 1rem;
            background: rgba(15, 23, 42, 0.8);
            padding: 0.75rem;
            border-radius: 1rem;
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            transition: transform 0.3s ease;
        }

        .fab-container.hidden {
            transform: translate(-50%, 150%);
        }

        /* Loader */
        .loader {
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-top: 2px solid white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            color: white;
            z-index: 1000;
            min-width: 300px;
            transform: translateY(-100px);
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: var(--shadow-xl);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification.success {
            background: rgba(16, 185, 129, 0.9);
        }

        .notification.error {
            background: rgba(239, 68, 68, 0.9);
        }

        /* Auto-save */
        .auto-save-indicator {
            position: fixed;
            top: 1.5rem;
            left: 1.5rem;
            padding: 0.5rem 1rem;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
            color: var(--success);
            border-radius: 2rem;
            font-size: 0.875rem;
            opacity: 0;
            transition: opacity var(--transition);
            z-index: 1000;
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .auto-save-indicator.show {
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .form-grid.two-cols {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2rem;
            }

            .fab-container {
                width: 90%;
                justify-content: center;
            }
        }
    </style>
</head>

<body>
    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>

    <!-- Auto-save indicator -->
    <div id="auto-save-indicator" class="auto-save-indicator">
        üíæ Rascunho salvo
    </div>

    <div class="container">
        <header class="header">
            <!-- <img src="logo.png" alt="SARA" class="logo"> -->
            <h1>Formul√°rio de Briefing de Dashboard</h1>
            <p>Forne√ßa o contexto chave para iniciarmos a an√°lise com o assistente de IA especializado em Business
                Intelligence.</p>
        </header>

        <form id="briefing-form" novalidate>
            <!-- Se√ß√£o 1: Identifica√ß√£o -->
            <div class="form-section">
                <h2>
                    <span class="section-icon">üìã</span>
                    1. Identifica√ß√£o do Projeto
                </h2>
                <div class="form-grid two-cols">
                    <div class="field-group">
                        <label for="panel-title" class="form-label">Nome do Dashboard *</label>
                        <input type="text" id="panel-title" class="form-input"
                            placeholder="Ex: Dashboard de Performance Comercial" required>
                    </div>
                    <div class="field-group">
                        <label for="requester-name" class="form-label">Seu Nome e Cargo *</label>
                        <input type="text" id="requester-name" class="form-input"
                            placeholder="Ex: Jo√£o Silva, Gerente de Vendas" required>
                    </div>
                    <div class="field-group">
                        <label for="business-area" class="form-label">Sua √Årea de Neg√≥cio *</label>
                        <input type="text" id="business-area" class="form-input"
                            placeholder="Ex: Comercial, Marketing, RH" required>
                    </div>
                    <div class="field-group">
                        <label for="request-date" class="form-label">Data da Solicita√ß√£o *</label>
                        <input type="date" id="request-date" class="form-input" required>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 2: Contexto e Objetivos -->
            <div class="form-section">
                <h2>
                    <span class="section-icon">üéØ</span>
                    2. Contexto e Objetivos
                </h2>
                <div class="field-group">
                    <label for="necessidade-geral" class="form-label">
                        Descreva a Sua Necessidade *
                        <span class="tooltip-icon"
                            data-tooltip="Explique o problema atual, o que voc√™ n√£o consegue ver hoje e qual decis√£o precisa tomar.">?</span>
                    </label>
                    <textarea id="necessidade-geral" class="form-textarea" rows="5" required
                        placeholder="Qual problema voc√™ quer resolver? Que perguntas precisam de resposta? Que decis√µes voc√™ quer tomar?"></textarea>
                    <div class="char-counter"><span id="necessidade-count">0</span> caracteres</div>
                </div>

                <div class="form-grid two-cols">
                    <div class="field-group">
                        <label class="form-label">Qual √© o objetivo principal?</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="objetivos" value="Monitorar">
                                <span>üìä Monitorar KPIs e m√©tricas</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="objetivos" value="Reduzir">
                                <span>‚¨áÔ∏è Reduzir custos ou tempo</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="objetivos" value="Otimizar">
                                <span>‚ö° Otimizar processos</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="objetivos" value="Identificar">
                                <span>üîç Identificar oportunidades</span>
                            </label>
                        </div>
                    </div>

                    <div class="field-group">
                        <label for="user-familiarity" class="form-label">Quem √© o p√∫blico-alvo principal? *</label>
                        <select id="user-familiarity" class="form-select">
                            <option value="">Selecione o p√∫blico</option>
                            <option value="Executivo (vis√£o macro)">üëî Executivo (vis√£o macro)</option>
                            <option value="Gerencial (an√°lise e detalhamento)">üìà Gerencial (an√°lise e detalhamento)
                            </option>
                            <option value="Anal√≠tico (explora√ß√£o profunda)">üî¨ Anal√≠tico (explora√ß√£o profunda)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o 3: KPIs e M√©tricas -->
            <div class="form-section">
                <h2>
                    <span class="section-icon">üìä</span>
                    3. KPIs e M√©tricas Chave
                </h2>
                <div class="field-group">
                    <label for="kpis" class="form-label">
                        Quais indicadores devem aparecer no painel? *
                        <span class="tooltip-icon"
                            data-tooltip="Liste os n√∫meros mais importantes. Seja espec√≠fico sobre a unidade (R$, %, Qtd).">?</span>
                    </label>
                    <textarea id="kpis" class="form-textarea" rows="4" required
                        placeholder="Ex:&#10;- Faturamento Bruto (R$)&#10;- Margem de Lucro (%)&#10;- Ticket M√©dio"></textarea>
                </div>
                <div class="field-group">
                    <label for="business-rules" class="form-label">
                        Regras de Neg√≥cio Espec√≠ficas
                        <span class="tooltip-icon"
                            data-tooltip="Exce√ß√µes ou condi√ß√µes especiais para o c√°lculo.">?</span>
                    </label>
                    <textarea id="business-rules" class="form-textarea" rows="3"
                        placeholder="Ex: 'Considerar apenas vendas com status Faturado', 'Excluir devolu√ß√µes'."></textarea>
                </div>
            </div>

            <!-- Se√ß√£o 4: Filtros e Dimens√µes -->
            <div class="form-section">
                <h2>
                    <span class="section-icon">üîç</span>
                    4. Filtros e Dimens√µes de An√°lise
                </h2>
                <div class="field-group">
                    <label for="dimensions" class="form-label">
                        Como voc√™ quer filtrar/quebrar esses dados? *
                        <span class="tooltip-icon"
                            data-tooltip="Os bot√µes de filtro que voc√™ quer no topo do painel.">?</span>
                    </label>
                    <textarea id="dimensions" class="form-textarea" rows="3" required
                        placeholder="Ex: Por Regi√£o, Por Vendedor, Por Categoria de Produto, Por Ano/M√™s."></textarea>
                </div>
            </div>

            <!-- Se√ß√£o 5: Requisitos T√©cnicos -->
            <div class="form-section">
                <h2>
                    <span class="section-icon">üóÑÔ∏è</span>
                    5. Fontes de Dados e Requisitos T√©cnicos
                </h2>
                <div class="field-group">
                    <label for="data-sources" class="form-label">
                        Fontes de Dados Dispon√≠veis *
                        <span class="tooltip-icon"
                            data-tooltip="Onde est√£o os dados? Qual o nome do banco ou arquivo?">?</span>
                    </label>
                    <textarea id="data-sources" class="form-textarea" rows="4" required
                        placeholder="Descreva detalhadamente as fontes de dados: sistemas, bancos, tabelas, planilhas."></textarea>
                </div>
                <div class="field-group">
                    <label for="update-frequency" class="form-label">Frequ√™ncia de atualiza√ß√£o necess√°ria? *</label>
                    <select id="update-frequency" class="form-select">
                        <option value="">Selecione a frequ√™ncia</option>
                        <option value="De hora em hora">üïê De hora em hora</option>
                        <option value="Diariamente" selected>üìÖ Diariamente</option>
                        <option value="Semanalmente">üìä Semanalmente</option>
                        <option value="Mensalmente">üìà Mensalmente</option>
                    </select>
                </div>
            </div>

            <!-- Floating Action Button -->
            <div class="fab-container">
                <button type="submit" id="submit-btn" class="btn btn-primary">
                    üöÄ Salvar e Copiar para SARA
                </button>
            </div>
        </form>

        <!-- Notifica√ß√£o -->
        <div id="notification" class="notification"></div>
    </div>

    <script>
        // Elementos DOM
        const form = document.getElementById('briefing-form');
        const notification = document.getElementById('notification');
        const autoSaveIndicator = document.getElementById('auto-save-indicator');
        const progressBar = document.getElementById('progress-bar');
        const fieldsToValidate = ['panel-title', 'requester-name', 'business-area', 'necessidade-geral', 'kpis', 'dimensions', 'data-sources'];

        // Auto-save variables
        let autoSaveTimeout;
        let lastSavedData = '';

        // Notification system
        function showNotification(message, type = 'success', duration = 4000) {
            notification.textContent = message;
            notification.className = `notification ${type}`;
            setTimeout(() => notification.classList.add('show'), 10);
            setTimeout(() => notification.classList.remove('show'), duration);
        }

        // Auto-save functionality
        function showAutoSaveIndicator() {
            autoSaveIndicator.classList.add('show');
            setTimeout(() => autoSaveIndicator.classList.remove('show'), 2000);
        }

        // Progress Bar Logic
        function updateProgressBar() {
            const totalFields = fieldsToValidate.length + 1; // +1 for user-familiarity
            let filledFields = 0;

            fieldsToValidate.forEach(id => {
                if (document.getElementById(id).value.trim()) filledFields++;
            });

            if (document.getElementById('user-familiarity').value) filledFields++;

            const percentage = (filledFields / totalFields) * 100;
            progressBar.style.width = `${percentage}%`;
        }

        // Character Counter Logic
        function updateCharCounter(id, counterId) {
            const field = document.getElementById(id);
            const counter = document.getElementById(counterId);
            if (field && counter) {
                counter.textContent = field.value.length;
                field.addEventListener('input', () => {
                    counter.textContent = field.value.length;
                });
            }
        }

        function getFormData() {
            const getChecked = (name) => Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)).map(cb => cb.value).join(', ');

            return {
                titulo: document.getElementById('panel-title').value,
                solicitante: document.getElementById('requester-name').value,
                areaNegocio: document.getElementById('business-area').value,
                dataSolicitacao: document.getElementById('request-date').value,
                necessidade: document.getElementById('necessidade-geral').value,
                objetivos: getChecked('objetivos'),
                publico: document.getElementById('user-familiarity').value,
                kpis: document.getElementById('kpis').value,
                regrasNegocio: document.getElementById('business-rules').value,
                dimensoes: document.getElementById('dimensions').value,
                fontesDados: document.getElementById('data-sources').value,
                frequencia: document.getElementById('update-frequency').value,
            };
        }

        function autoSave() {
            const formData = getFormData();
            const currentData = JSON.stringify(formData);

            // Only save if data has changed
            if (currentData !== lastSavedData && Object.values(formData).some(value => value.trim())) {
                localStorage.setItem('briefing-draft', currentData);
                lastSavedData = currentData;
                showAutoSaveIndicator();
                updateProgressBar();
            }
        }

        function loadDraft() {
            const draft = localStorage.getItem('briefing-draft');
            if (draft) {
                try {
                    const data = JSON.parse(draft);

                    // Fill form fields
                    Object.entries(data).forEach(([key, value]) => {
                        if (key === 'objetivos') {
                            const values = value.split(', ').filter(v => v);
                            document.querySelectorAll('input[name="objetivos"]').forEach(cb => {
                                cb.checked = values.includes(cb.value);
                            });
                        } else {
                            const field = document.getElementById(key === 'titulo' ? 'panel-title' :
                                key === 'solicitante' ? 'requester-name' :
                                    key === 'areaNegocio' ? 'business-area' :
                                        key === 'dataSolicitacao' ? 'request-date' :
                                            key === 'necessidade' ? 'necessidade-geral' :
                                                key === 'publico' ? 'user-familiarity' :
                                                    key === 'kpis' ? 'kpis' :
                                                        key === 'regrasNegocio' ? 'business-rules' :
                                                            key === 'dimensoes' ? 'dimensions' :
                                                                key === 'fontesDados' ? 'data-sources' :
                                                                    key === 'frequencia' ? 'update-frequency' : key);
                            if (field && value) {
                                field.value = value;
                            }
                        }
                    });

                    lastSavedData = draft;
                    showNotification('Rascunho carregado automaticamente', 'success', 2000);
                    updateProgressBar();
                } catch (error) {
                    console.error('Erro ao carregar rascunho:', error);
                }
            }
        }

        // Form validation
        function validateForm() {
            let isFormValid = true;

            fieldsToValidate.forEach(id => {
                const field = document.getElementById(id);
                if (!field.value.trim()) {
                    field.classList.add('invalid');
                    isFormValid = false;
                } else {
                    field.classList.remove('invalid');
                }
            });

            // Validate public field
            const publicField = document.getElementById('user-familiarity');
            if (!publicField.value) {
                publicField.classList.add('invalid');
                isFormValid = false;
            } else {
                publicField.classList.remove('invalid');
            }

            return isFormValid;
        }

        // Form submission
        form.addEventListener('submit', async function (event) {
            event.preventDefault();

            if (!validateForm()) {
                showNotification('Por favor, preencha todos os campos obrigat√≥rios.', 'error');
                // Scroll to first invalid field
                const firstInvalid = document.querySelector('.invalid');
                if (firstInvalid) {
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstInvalid.focus();
                }
                return;
            }

            const submitBtn = document.getElementById('submit-btn');
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = `<div class="loader"></div> Salvando...`;

            const formData = getFormData();

            try {
                // Generate briefing text
                let briefingText = `BRIEFING DO PROJETO: ${formData.titulo}\n========================\n\n`;
                briefingText += `## 1. INFORMA√á√ïES GERAIS\n- **Solicitante:** ${formData.solicitante}\n- **√Årea:** ${formData.areaNegocio}\n- **Data:** ${new Date(formData.dataSolicitacao).toLocaleDateString('pt-BR')}\n\n`;
                briefingText += `## 2. CONTEXTO E OBJETIVOS\n- **Descri√ß√£o da Necessidade:** ${formData.necessidade}\n- **Objetivo Principal:** ${formData.objetivos || 'N√£o especificado'}\n- **Perfil do P√∫blico:** ${formData.publico}\n\n`;
                briefingText += `## 3. KPIS E M√âTRICAS\n${formData.kpis}\n\n`;
                if (formData.regrasNegocio) {
                    briefingText += `## REGRAS DE NEG√ìCIO\n${formData.regrasNegocio}\n\n`;
                }
                briefingText += `## 4. FILTROS E DIMENS√ïES\n${formData.dimensoes}\n\n`;
                briefingText += `## 5. REQUISITOS T√âCNICOS\n- **Fontes de Dados:** ${formData.fontesDados}\n- **Frequ√™ncia de Atualiza√ß√£o:** ${formData.frequencia}\n\n`;
                briefingText += `---\nBriefing gerado automaticamente pelo SARA BI Assistant\nData: ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}`;

                // Save to localStorage and clipboard
                localStorage.setItem('pendingBriefing', briefingText);
                await navigator.clipboard.writeText(briefingText);

                // Clear draft
                localStorage.removeItem('briefing-draft');

                // Notify user to paste in SARA
                showNotification('‚úÖ Briefing copiado! Cole na SARA para iniciar.', 'success', 5000);
                submitBtn.innerHTML = '‚úÖ Copiado! Cole na SARA';
                submitBtn.style.background = 'linear-gradient(135deg, var(--success) 0%, #059669 100%)';

                // Reset button after 5 seconds
                setTimeout(() => {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalBtnText;
                    submitBtn.style.background = '';
                }, 5000);

            } catch (error) {
                console.error("Erro no processo de submiss√£o:", error);
                showNotification(`‚ùå Erro: ${error.message}`, 'error');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalBtnText;
            }
        });

        // Auto-save on input
        form.addEventListener('input', function () {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(autoSave, 2000); // Save after 2 seconds of inactivity
            updateProgressBar();
        });

        // Real-time validation
        fieldsToValidate.forEach(id => {
            const field = document.getElementById(id);
            field.addEventListener('blur', function () {
                if (this.value.trim()) {
                    this.classList.remove('invalid');
                }
                updateProgressBar();
            });
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function () {
            // Set current date
            document.getElementById('request-date').valueAsDate = new Date();

            // Initialize char counter
            updateCharCounter('necessidade-geral', 'necessidade-count');

            // Load draft if exists
            loadDraft();

            // Initial progress update
            updateProgressBar();

            // Focus first field
            document.getElementById('panel-title').focus();
        });

        // Prevent data loss on page unload
        window.addEventListener('beforeunload', function (e) {
            autoSave();
        });

        // Enhanced UX: Auto-resize textareas
        document.querySelectorAll('.form-textarea').forEach(textarea => {
            textarea.addEventListener('input', function () {
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px';
            });
        });
    </script>
</body>

</html>